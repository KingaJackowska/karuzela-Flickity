<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css" media="screen">
    <link rel="stylesheet" href="vendor/flickity.min.css" media="screen">
    <link rel="stylesheet" href="vendor/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
    
        <a href="#carousel-cell1">View cell 1</a>
        <a href="#carousel-cell2">View cell 2</a>
        <a href="#carousel-cell3">View cell 3</a>
        <a href="#carousel-cell4">View cell 4</a>
        <a href="#carousel-cell5">View cell 5</a>
    
    <div class="container">
        <div class="karuzela">
            <div class="carousel" id="carousel">
                <!-- <div class="carousel-cell style" id="carousel-cell1"><p>1</p></div>-->
            </div>
            <div class="progress-bar"></div>
            
            <div class="button">
                <a href="#carousel-cell1"><button class="buttonredo"><i class="fas fa-redo-alt redo"></i></button></a>
            </div>
        </div>
    </div>

        
    <div class="container">
            <button id="centerSyd">Center Sydney</button>
            <button id="center-smooth">Center smoothly</button>
            <p id="opisos"></p>
            <div id="map"></div>
        </div>




<!--  -------SCRIPTS-------- -->

    <script>
        var myData = [
            {
                image: '<img src="http://via.placeholder.com/400x200" alt="Photo placeholder">', 
                title: '<p>Lorem ipsum.</p>',
                description: '<p>Dolor sit.</p>',
                coords: {lat: -24.300, lng: 134.040} 
            },
            {
                image: '<img src="http://via.placeholder.com/400x200" alt="Photo placeholder">', 
                title: '<p>Lorem ipsum.</p>',
                description: '<p>Dolor sit.</p>',
                coords: {lat: -24.400, lng: 134.040}
            },
            {
                image: '<img src="http://via.placeholder.com/400x200" alt="Photo placeholder">', 
                title: '<p>Lorem ipsum.</p>',
                description: '<p>Dolor sit.</p>',
                coords: {lat: -24.500, lng: 134.040}
            }
        ];

    </script>

    <script id="template-slajd" type="x-tmpl-mustache">
        <div class="carousel-cell style" id="{{id}}">
            {{{ image }}}
            {{{ title }}}
            {{{ description }}}
        </div>
    </script>

    

    <script src="vendor/flickity.pkgd.min.js"></script>
    <script src="js/hash.js"></script>
    <script src="vendor/mustache.js"></script>
    <script src="js/script.js"></script>

    
    <script>
        (function(){
            // Initialize and add the map
            window.initMap = function(){
    
            // The location of Uluru
            var uluru = {lat: -25.344, lng: 131.036};   
		    var coords2 = {lat: -25.363, lng: 134.044};
            var coords3 = {lat: -25.363, lng: 137.044};
            var sydney = {lat: -33.874237, lng: 151.198517};
            var Cell1 = {lat: -24.300, lng: 134.040};
            var Cell2 = {lat: -24.400, lng: 134.040};
            var Cell3 = {lat: -24.500, lng: 134.040};
            
            // The map, centered at Uluru
            var cellNumber = flkty.selectedIndex;
            var actualCoords = myData[cellNumber]['coords'];

            var map = new google.maps.Map(
                document.getElementById('map'), {zoom: 9.5, center: actualCoords});
    
            // The marker, positioned at Uluru
            var marker1 = new google.maps.Marker({position: uluru, map: map});
            var marker2 = new google.maps.Marker({position: coords2, map: map});
            var marker3 = new google.maps.Marker({position: coords3, map: map});
            var markerSyd = new google.maps.Marker({position: sydney, map: map});
            var markerCell1 = new google.maps.Marker({position: Cell1, map: map});
            var markerCell2 = new google.maps.Marker({position: Cell2, map: map});
            var markerCell3 = new google.maps.Marker({position: Cell3, map: map});

            marker1.addListener('click', function(){
                opisos.innerHTML = 'Opisos renderos: marker1';
            });	
            marker2.addListener('click', function(){
                opisos.innerHTML = 'Opisos renderos: marker2';
            });	
            marker3.addListener('click', function(){
                opisos.innerHTML = 'Opisos renderos: marker3';
		    });	
            markerSyd.addListener('click', function(){
                opisos.innerHTML = 'Opisos renderos: Sydney';
            });	

            // button centrujący na Sydney
            var center = document.getElementById('centerSyd');
            center.addEventListener('click', function(event){
                event.preventDefault();
                map.panTo(sydney);
			    map.setZoom(10);
            });
            
            // button centrujący na Sydney płynnie
            var smooth = document.getElementById('center-smooth');
            smooth.addEventListener('click', function(event){
			    event.preventDefault();
			    smoothPanAndZoom(map, 7, sydney);
            });

            // Aktywna mapa przy przewijaniu slajdów
            flkty.on( 'scroll', function( progress ) {
                cellNumber = flkty.selectedIndex
                actualCoords = myData[cellNumber]['coords'];
                map.panTo(actualCoords);
                map.setZoom(9.5);
                console.log(cellNumber);
            });


        



         //Początek funkcji smoothPanAndZoom
        
                    var smoothPanAndZoom = function(map, zoom, coords){
                // Trochę obliczeń, aby wyliczyć odpowiedni zoom do którego ma oddalić się mapa na początku animacji.
                var jumpZoom = zoom - Math.abs(map.getZoom() - zoom);
                jumpZoom = Math.min(jumpZoom, zoom -1);
                jumpZoom = Math.max(jumpZoom, 3);

                // Zaczynamy od oddalenia mapy do wyliczonego powiększenia. 
                smoothZoom(map, jumpZoom, function(){
                    // Następnie przesuwamy mapę do żądanych współrzędnych.
                    smoothPan(map, coords, function(){
                        // Na końcu powiększamy mapę do żądanego powiększenia. 
                        smoothZoom(map, zoom); 
                    });
                });
            };
            
            var smoothZoom = function(map, zoom, callback) {
                var startingZoom = map.getZoom();
                var steps = Math.abs(startingZoom - zoom);
                
                // Jeśli steps == 0, czyli startingZoom == zoom
                if(!steps) {
                    // Jeśli podano trzeci argument
                    if(callback) {
                        // Wywołaj funkcję podaną jako trzeci argument.
                        callback();
                    }
                    // Zakończ działanie funkcji
                    return;
                }

                // Trochę matematyki, dzięki której otrzymamy -1 lub 1, w zależności od tego czy startingZoom jest mniejszy od zoom
                var stepChange = - (startingZoom - zoom) / steps;

                var i = 0;
                // Wywołujemy setInterval, który będzie wykonywał funkcję co X milisekund (X podany jako drugi argument, w naszym przypadku 80)
                var timer = window.setInterval(function(){
                    // Jeśli wykonano odpowiednią liczbę kroków
                    if(++i >= steps) {
                        // Wyczyść timer, czyli przestań wykonywać funkcję podaną w powyższm setInterval
                        window.clearInterval(timer);
                        // Jeśli podano trzeci argument
                        if(callback) {
                            // Wykonaj funkcję podaną jako trzeci argument
                            callback();
                        }
                    }
                    // Skorzystaj z metody setZoom obiektu map, aby zmienić powiększenie na zaokrąglony wynik poniższego obliczenia
                    map.setZoom(Math.round(startingZoom + stepChange * i));
                }, 80);
            };

            // Poniższa funkcja działa bardzo podobnie do smoothZoom. Spróbuj samodzielnie ją przeanalizować. 
            var smoothPan = function(map, coords, callback) {
                var mapCenter = map.getCenter();
                coords = new google.maps.LatLng(coords);

                var steps = 12;
                var panStep = {lat: (coords.lat() - mapCenter.lat()) / steps, lng: (coords.lng() - mapCenter.lng()) / steps};

                var i = 0;
                var timer = window.setInterval(function(){
                    if(++i >= steps) {
                        window.clearInterval(timer);
                        if(callback) callback();
                    }
                    map.panTo({lat: mapCenter.lat() + panStep.lat * i, lng: mapCenter.lng() + panStep.lng * i});
                }, 1000/30);
            }; 

          // Koniec funkcji smoothPanAndZoom




            }

            var opisos = document.getElementById('opisos');

        })();
        </script>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaWv85jEokeneWmZiCx0kPuuQ3JZI4Lnw&callback=initMap">
    </script>
</body>
</html>